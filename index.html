<!DOCTYPE html>
<html lang="en">
<head>
	<title>Covid-19 Ontario</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-->
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/perfect-scrollbar/perfect-scrollbar.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--===============================================================================================-->
</head>
<body>
<div class="limiter">
	<div class="container-table100">
		<div class="wrap-table100">
			<div class="inner"><button onclick="CreateOneTable(deployurl + '/api/york')">
				<span>York Region</span>
			</button> </div>
			<div class="inner"> <button onclick="CreateTables(deployurl + '/api/halton')">
				<span>Halton Region</span>
			</button> </div>
			<div class="inner"> <button onclick="CreateTables(deployurl + '/api/niagara')">
				<span>Niagara Region</span>
			</button> </div>
			<div class="inner"> <button onclick="CreateOneTable(deployurl + '/api/peel')">
				<span>Peel Region</span>
			</button> </div>
			<div class="inner"> <button onclick="CreateTables(deployurl + '/api/waterloo')">
				<span>Waterloo Region</span>
			</button> </div>
			<div class="inner"> <button onclick="CreateTables(deployurl + '/api/durham')">
				<span>Durham Region</span>
			</button> </div>
			<div id="table100"> </div>
		</div>
	</div>
</div>
<script>
	const localurl = 'http://localhost:5000';
	const deployurl = 'https://vast-reaches-02757.herokuapp.com';
	async function CreateOneTable(url) {
		let response = await fetch(url, {mode: 'cors'});
		/*response is the table body*/
		response = (await response.json()).tbody;

		/*Create table */
		let table = document.createElement('table');
		let tbody = document.createElement('tbody');
		let th = document.createElement('thead');
		table.appendChild(th);
		table.appendChild(tbody);

		if(url !== url + '/api/peel') {
			/*table header*/
			let tr = document.createElement('tr');
			tr.classList.add('table100-head');
			for(let i = 0; i < response[0].length; i++) {
				let td = document.createElement('th');
				td.classList.add(`column${i+1}`);
				td.innerHTML = response[0][i];
				tr.appendChild(td);
			}
			th.appendChild(tr);
		}

		/*push rows into table*/
		for(let i = 0; i < response.length; i++) {
			if((url !== url + '/api/peel') && (i===0)) continue;
			let tr = document.createElement('tr');
			for(let j = 0; j < response[i].length; j++) {
				let td = document.createElement('td');
				td.classList.add(`column${j+1}`);
				td.innerText = response[i][j];
				tr.appendChild(td);
			}
			tbody.appendChild(tr);
		}

		// FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
		let divContainer = document.getElementById('table100');
		divContainer.innerHTML = '';
		divContainer.appendChild(table);
	}
	async function CreateTables(url) {
		/*find table100 container*/
		let divContainer = document.getElementById('table100');
		divContainer.innerHTML = '';

		let response = await fetch(url);

		/*when data is not usable*/
		if(response.status === 401) {
			const url = await response.json();
			let link = document.createElement('a');
			link.href = url;
			link.innerHTML = 'The data is not accessible, click on this link';
			divContainer.appendChild(link);
			return
		}

		const resTables = (await response.json()).tables;
		resTables.forEach(element => {
			let elementBody = element.tbody;
			// CREATE DYNAMIC TABLE.
			let table = document.createElement('table');
			let tbody = document.createElement('tbody');
			let th = document.createElement('thead');
			table.appendChild(th);
			table.appendChild(tbody);

			/*table header*/
			let tr = document.createElement('tr');
			tr.classList.add('table100-head');
			for(let i = 0; i < elementBody[0].length; i ++) {
				let td = document.createElement('th');
				td.classList.add(`column${i+1}`);
				td.innerHTML = elementBody[0][i];
				tr.appendChild(td);
			}
			th.appendChild(tr);

			/*push rows into table*/
			for(let i = 1; i < elementBody.length; i++) {
				let tr = document.createElement('tr');
				for(let j = 0; j < elementBody[i].length; j++) {
					let td = document.createElement('td');
					td.classList.add(`column${j+1}`);
					td.innerText = elementBody[i][j];
					tr.appendChild(td);
				}
				tbody.appendChild(tr);
			}

			// divContainer.innerHTML = "";
			divContainer.appendChild(table);
		});
	}
</script>


<!--===============================================================================================-->
<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
<script src="vendor/bootstrap/js/popper.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
<script src="vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
<script src="js/main.js"></script>

</body>
</html>